{% extends 'periodicals/base.html' %}
{% load periodicals_tags %}

{% block meta_title %}
{{ publication }}
{% endblock %}

{% block title %}
{{ publication }}
{% endblock %}

{% block main %}

<div class="row">
    <div class="small-12 columns minus-margin-top">
        <ul class="menu float-left">
            <li>
                <a href="{% url 'publication-list' %}" ><i class="fa fa-arrow-left" aria-hidden="true"></i> Back to Explore</a>
            </li>
        </ul>
    </div>
</div>

{% if publication.description %}
<section>
    <div class="row">
        <div class="small-12 columns">
            <h3>Description</h3>
            <div class="description-trunk">
                {{ publication.description | truncatewords_html:40 }}

                <a class="read-more" data-target="#description-full">Read more</a>
            </div>
            <div class="description-full" id="description-full">
                {{ publication.description }}
            </div>
        </div>
    </div>
</section>
{% endif %}





<!-- New template but no tags -->
<div class="row" id="main">
    <div class="small-12 medium-3 columns" data-sticky-container>
    <h2>Years</h2>
        <div class="menu vertical" data-magellan>
            <ul class="multilevel-accordion-menu vertical menu" data-accordion-menu>
                {% for year in publication.get_year_range %}
                <li>
                    <a href="?year={{year}}">{{year}}</a>

                    <ul class="menu vertical">
                        {% with issues=publication|get_issues_by_year:year %}
                        {% regroup issues by issue_date as dates %}
                        {% for date in dates %}
                        <li>
                            <a href="#">{{ date.grouper }}</a>
                            <ul class="menu vertical">
                                {% for issue in date.list %}
                                <li><a href="{{issue.url}}">{{ issue.name }}</a></li>
                                {% endfor %}
                            </ul>
                        </li>
                        {% endfor %}
                        {% endwith %}
                    </ul>
                </li>
               {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Cards -->
    <div class="medium-9 columns">
        {% if 'year' in request.GET %}
            {% include "periodicals/includes/issue_gallery.html" with issues=publication|get_issues_by_year:request.GET.year %}
        {% else %}
            {% include "periodicals/includes/issue_gallery.html" with issues=publication|get_issues_by_year:publication.year_from %}
        {% endif %}
    </div>
</div>



{% endblock %}
