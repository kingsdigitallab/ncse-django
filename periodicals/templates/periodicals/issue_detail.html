{% extends 'periodicals/base.html' %}
{% load humanize periodicals_tags %}

{% block title %}
{{ issue.publication}}, {{ issue.issue_date|date:"j N Y" }}, {{ issue.edition_or_component }}
{% endblock %}

{% block meta_title %}
{{ issue.publication}}, {{ issue.issue_date|date:"j N Y" }}, {{ issue.edition_or_component }}
{% endblock %}

{% block main %}


{% with ads=issue.ads departments=issue.departments articles=issue.articles pictures=issue.pictures editions=issue.get_editions components=issue.get_components %}

<div class="row" id="main">
    <div class="small-12 medium-3 columns" data-sticky-container>
        <div class="sticky" data-sticky data-anchor="main">
            <div class="menu vertical">
                
                <ul class="vertical tabs" data-tabs id="issue-nav">
                    <h2>Items</h2>
                    <li class="tabs-title is-active">
                        <a href="#departments">Departments <span>({{departments.count}})</span></a>
                    </li>
                    {% if ads %}
                    <li class="tabs-title">
                        <a href="#ads">Adverts <span>({{ ads.count }})</i></span></a>
                    </li>
                    {% endif %}
                    {% if pictures %}
                    <li class="tabs-title">
                        <a href="#images">Pictures <span>({{pictures.count}})</i></span></a>
                    </li>
                    {% endif %}
                    {% if articles %}
                    <li class="tabs-title">
                        <a href="#text">Text <span>({{ articles.count}})</i></span></a>
                    </li>
                    {% endif %}
                    {% if editions %}
                    <li class="tabs-title">
                        <a href="#editions">Other Editions <span>({{ editions.count}})</i></span></a>
                    </li>
                    {% endif %}
                    {% if components %}
                    <li class="tabs-title">
                        <a href="#components">Other Components <span>({{ components.count}})</i></span></a>
                    </li>
                    {% endif %}
                    <li class="tabs-title">
                        <a href="#pages">Pages <span>({{ issue.number_of_pages }})</span></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    

    <div class="medium-9 columns tabs-content" data-tabs-content="issue-nav">
        {% if departments %}
        <div class="row margin-bottom tabs-panel is-active" id="departments">
            <div class="column">
            <h2 class="underline">Departments</h2>
            </div>
            {% regroup departments by page as page_list %}
            {% for page in page_list %}
                {% for department in page.list %}
                    <div class="medium-2 columns">
                        {% if forloop.first %}
                        Page {{ page.grouper.number }}
                        {% endif %}
                    </div>
                    <div class="medium-10 columns margin-bottom">
                        <img class="border" src="{% thumbnail department.title_image.url %}" alt="{{ department }}">
                        <p>OCR text</p>
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
        {% endif %}


        {% if ads %}    
        
        <div class="row margin-bottom tabs-panel" id="ads">   
        <div class="column">
        <h2 class="underline">Adverts</h2>
        </div>
        {% include "periodicals/includes/issue_toc.html" with items=ads %}
        </div>
        {% endif %}

        {% if pictures %}
        <div class="row margin-bottom tabs-panel" id="images">   
        <div class="column">
        <h2 class="underline">Images</h2>
        </div>
        {% include "periodicals/includes/issue_toc.html" with items=pictures %}
        </div>
        {% endif %}
  
        {% if articles %}
        <div class="row margin-bottom tabs-panel" id="text"> 
        <div class="column">
        <h2 class="underline">Text</h2>  
        </div>
        {% include "periodicals/includes/issue_toc.html" with items=articles %}
        </div>
        {% endif %}


        {% if components %}
        <div class="row margin-bottom tabs-panel" id="components"> 
        <div class="column">
        <h2 class="underline margin-bottom">Other Components</h2>  
        {% include "periodicals/includes/issue_gallery.html" with issues=components %}
        </div> 
        </div>
        {% endif %}

        {% if editions %}
        <div class="row margin-bottom tabs-panel" id="editions"> 
        <div class="column">
        <h2 class="underline margin-bottom">Other Editions</h2>  
        {% include "periodicals/includes/issue_gallery.html" with issues=editions %}
        </div>
        </div>
        {% endif %}

        <div class="row margin-bottom tabs-panel" id="pages">
        <div class="column">
        <h2 class="underline margin-bottom">Pages</h2>
        {% include "periodicals/includes/page_gallery.html" with pages=issue.pages.all %}
        </div>
        </div>

    </div>
</div>

{% endwith %}

{% endblock %}