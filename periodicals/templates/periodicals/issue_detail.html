{% extends 'periodicals/base.html' %}
{% load humanize periodicals_tags %}

{% block title %}
{{ issue }}
{% endblock %}

{% block meta_title %}
{{ issue }}
{% endblock %}

{% block main %}

{% with ads=issue.ads departments=issue.departments articles=issue.articles pictures=issue.pictures editions=issue.get_editions components=issue.get_components %}
<div class="row" id="main">
    <div class="small-12 medium-3 columns" data-sticky-container>
        <div class="sticky" data-sticky data-anchor="main">
            <div class="menu vertical">
                <ul class="multilevel-accordion-menu vertical menu" data-magellan>
                    <li>
                        <a href="#departments">Departments <span>({{departments.count}})</span></a>
                    </li>
                    {% if ads %}
                    <li>
                        <a href="#ads">Adverts <span>({{ ads.count }})</i></span></a>
                    </li>
                    {% endif %}
                    {% if pictures %}
                    <li>
                        <a href="#images">Pictures <span>({{pictures.count}})</i></span></a>
                    </li>
                    {% endif %}
                    {% if articles %}
                    <li>
                        <a href="#text">Text <span>({{ articles.count}})</i></span></a>
                    </li>
                    {% endif %}
                    {% if editions %}
                    <li>
                        <a href="#editions">Other Editions <span>({{ editions.count}})</i></span></a>
                    </li>
                    {% endif %}
                    {% if components %}
                    <li>
                        <a href="#editions">Other Components <span>({{ components.count}})</i></span></a>
                    </li>
                    {% endif %}
                    <li>
                        <a href="#pages">Pages <span>({{ issue.number_of_pages }})</span></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    

    <div class="medium-9 columns">
        {% if departments %}
        <div class="row margin-bottom">
            <div class="column">
            <h2 class="underline" id="departments">Departments</h2>
            </div>
            {% regroup departments by page as page_list %}
            {% for page in page_list %}
                {% for department in page.list %}
                   
                    <div class="medium-2 columns">

                        {% if forloop.first %}
                        Page {{ page.grouper.number }}
                        {% endif %}
                    </div>
                    <div class="medium-10 columns margin-bottom">
                        <!-- TO - Remove span style border -->
                        <img style="border:1px solid #ccc" src="{% thumbnail department.title_image.url %}" alt="{{ department }}">
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
        {% endif %}


        {% if ads %}    
        
        <div class="row margin-bottom">   
        <div class="column">
        <h2 class="underline" id="ads">Adverts</h2>
        </div>
        {% include "periodicals/includes/issue_toc.html" with items=ads %}
        </div>
        {% endif %}

        {% if pictures %}
        <div class="row margin-bottom">   
        <div class="column">
        <h2 class="underline" id="images">Images</h2>
        </div>
        {% include "periodicals/includes/issue_toc.html" with items=pictures %}
        </div>
        {% endif %}
  
        {% if articles %}
        <div class="row margin-bottom"> 
        <div class="column">
        <h2 class="underline" id="text">Text</h2>  
        </div>
        {% include "periodicals/includes/issue_toc.html" with items=articles %}
        </div>
        {% endif %}


        {% if components %}
        <div class="row margin-bottom"> 
        <div class="column">
        <h2 class="underline" id="editions">Other Components</h2>  
        </div>
        {% include "periodicals/includes/issue_gallery.html" with issues=components %}
        </div>
        {% endif %}

        {% if editions %}
        <div class="row margin-bottom"> 
        <div class="column">
        <h2 class="underline" id="editions">Other Editions</h2>  
        </div>
        {% include "periodicals/includes/issue_gallery.html" with issues=editions %}
        </div>
        {% endif %}

        <div class="row margin-bottom">
        <div class="column">
        <h2 class="underline margin-bottom" id="pages" >Pages</h2>
        </div>
        <div class="column">
        {% include "periodicals/includes/page_gallery.html" with pages=issue.pages.all %}
        </div>
        </div>

    </div>
</div>

{% endwith %}

{% endblock %}